<% @currentFirstName = @patients.find(@currentPatient).first_name%>
<% @currentLastName = @patients.find(@currentPatient).last_name%>
<head>
  <style>
    body{
      font-family: 'Source Sans Pro', sans-serif;
      background-color: #fceae8;
      margin: 0px;
    }
    h1{
      color: #003354;
      font-family: 'Lato', sans-serif;
      font-style: italic;
    }
    h4{
      font-weight: 400; 
      font-style: italic;
    }
    table{
      margin-left: 20px;
      margin-right: 20px;
      width: 100%;
    }
    table,td,th{
      border: 1px solid #a6a6a6;
    }
    th{
      font-size: 17px;
      font-weight: 600;
    }
    td{
      font-size: 15px;
    }
    .btn-primary{
      background-color: #003354;
      color: white;
      text-align: center;
    }
    .btn-primary:visited{
      color: white;
    }
    .btn-secondary{ 
      color: #003354;
      background-color: #f9d58c;
      font-size:15px; 
      font-weight: 400;
      padding: 3px 5px;
      margin: 3px;
    }
    .btn-secondary:hover{
      background-color: #fcedcf;
      color: #33adff;
    }
    .btn-secondary.btn-sm{
      color: #003354;
      background-color: #e5e5e6;
      font-size:13px; 
      padding: 3px 5px;
      margin: 2px;
    }
    .btn-secondary:hover.btn-sm{
      background-color: #f2f2f3;
    }
    .right {
      position: absolute;
      right: 7px;
    }
    #header{
      font-family: 'Lato', sans-serif;
      background-color: #003354;
      color:white;
    }
  </style>
</head>
<body>
  <% if @currentPatient.approved %>
    <!-- =================== HEADER =================== -->
    <div id="header">
      <div class="row" style="margin: 0px;">
        <div class="col">
            <h2>Upcoming Appointments</h2>
            <h4><%= @currentFirstName %> <%= @currentLastName%></h4>
        </div>
        <div class="col-1">
          <%= button_to 'Edit Account', edit_patient_path(@currentPatient), method: :get, class: "btn btn-secondary right", style: "padding: 3px; margin: 6px 3px 0px 0px;" %>
          <br><br>
          <%= button_to 'Log Out', logout_path, class: "btn btn-secondary right", style: "padding: 3px;" %>
        </div>
      </div>
    </div>
    <p id="notice" class="text-center" style="font-size: 14px;"><%= notice %></p>
    <!-- =================== MAIN STUFF =================== -->
    <div style="margin: 20px;">
      <table cellpadding="5">
        <thead>
          <tr>
            <th>Driver</th>
            <th>Date & Time</th>
            <th>Pick-up Location</th>
            <th>Destination</th>
            <th>Actions</th>
          </tr>
        </thead>
      
        <tbody>
          <% @appointments.where('patient_id' => @currentPatient).each do |appointment| %>
          <tr>
            <% @pickUpLocationid = appointment.location[0]["_id"] %>
            <% @destinationid = appointment.location[1]["_id"] %>
            <% if appointment.status == 0 %>
              <td style="color:red">Unassigned</td>
            <% else %>
              <% @drivers.find(appointment.driver_id) %>
              <% @tempDriver = ->(x) {x.first_name + ' ' + x.last_name}.call(@drivers.find(appointment.driver_id)) %>
              <td><%= @tempDriver %></td>
            <% end %>
            <td><%= appointment.datetime %></td>
            <td>
              <%= appointment.location[0].name %>
              <br>
              <%= appointment.location[0].address %>
            </td>
            
            <td>
              <%= appointment.location[1].name %>
              <br>
              <%= appointment.location[1].address %>
            </td>
            <td style="padding: 6px;">
              <%= button_to 'Details', appointment, method: :get, class: "btn btn-secondary btn-sm" %>
              <%= button_to 'Update Date', edit_appointment_path(appointment), method: :get, class: "btn btn-secondary btn-sm" %>
              <%= button_to 'Update Pick-up Location', edit_appointment_location_path(appointment.id, @pickUpLocationid), method: :get, class: "btn btn-secondary btn-sm" %>
              <%= button_to 'Update Destination', edit_appointment_location_path(appointment.id, @destinationid), method: :get, class: "btn btn-secondary btn-sm" %>
              <%= button_to 'Cancel Appointment', appointment, method: :delete , data: { confirm: 'Are you sure?' }, class: "btn btn-secondary btn-sm"%>
            </td>
          </tr>
          <% end %>
        </tbody>
      </table>
      <div class="text-center" style="padding: 12px;"> 
        <%= link_to 'Create New Appointment',{action: :new, controller: :appointments, patient_id: @currentPatient.id}, method: :get, class: "btn btn-primary", style: ""%>
      </div>
    </div>
  <% else %>
    <br><h1>Pending approval</h1><br>
  <% end %>

  
</body>
